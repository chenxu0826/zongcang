<template>
  <!--批量外出-->
  <el-row class="batchOut">
    <el-col :span="1" style="height:10px"></el-col>
    <el-col :span="22" class="title">批量外出（30）</el-col>
    <el-col :span="1" style="height:10px"></el-col>

    <el-col :span="24" class="content">
      <el-row>
        <el-col :span="2" style="height:10px"></el-col>
        <el-col :span="5" class="contentTitle">外出事由</el-col>
        <el-col :span="7" class="contentTitle">外出地点</el-col>
        <el-col :span="10" class="contentTitle">陪同民警</el-col>
      </el-row>
      <el-row>
        <el-col :span="2" style="height:10px"></el-col>
        <el-col :span="5" class="contentText">外出就医</el-col>
        <el-col :span="7" class="contentText">江苏省公安医院</el-col>
        <el-col :span="10" class="contentText">张三警、李四警、王五警</el-col>
      </el-row>

    </el-col>
    <el-row>
      <el-col :span="1" style="height:10px">

      </el-col>
      <el-col :span="22">
        <el-col :span="2" style="padding:15px 5px;">
          <div style="height:160px;background: rgba(0, 0, 0, 0.2);padding:10px">
            <el-col :span="24">
              <img src="../../assets/crimal_1_03.jpg" style="width:100px">
            </el-col>
              <el-col :span="24">
                张三犯
              </el-col>
          </div>
        </el-col>
        <el-col :span="2" style="padding:15px 5px;">
          <div style="height:160px;background: rgba(0, 0, 0, 0.2);padding:10px">
            <el-col :span="24">
              <img src="../../assets/crimal_1_03.jpg" style="width:100px">
            </el-col>
              <el-col :span="24">
                张三犯
              </el-col>
          </div>
        </el-col>
        <el-col :span="2" style="padding:15px 5px;">
          <div style="height:160px;background: rgba(0, 0, 0, 0.2);padding:10px">
            <el-col :span="24">
              <img src="../../assets/crimal_1_03.jpg" style="width:100px">
            </el-col>
              <el-col :span="24">
                张三犯
              </el-col>
          </div>
        </el-col>
        <el-col :span="2" style="padding:15px 5px;">
          <div style="height:160px;background: rgba(0, 0, 0, 0.2);padding:10px">
            <el-col :span="24">
              <img src="../../assets/crimal_1_03.jpg" style="width:100px">
            </el-col>
              <el-col :span="24">
                张三犯
              </el-col>
          </div>
        </el-col>
        <el-col :span="2" style="padding:15px 5px;">
          <div style="height:160px;background: rgba(0, 0, 0, 0.2);padding:10px">
            <el-col :span="24">
              <img src="../../assets/crimal_1_03.jpg" style="width:100px">
            </el-col>
              <el-col :span="24">
                张三犯
              </el-col>
          </div>
        </el-col>
        <el-col :span="2" style="padding:15px 5px;">
          <div style="height:160px;background: rgba(0, 0, 0, 0.2);padding:10px">
            <el-col :span="24">
              <img src="../../assets/crimal_1_03.jpg" style="width:100px">
            </el-col>
              <el-col :span="24">
                张三犯
              </el-col>
          </div>
        </el-col>
        <el-col :span="2" style="padding:15px 5px;">
          <div style="height:160px;background: rgba(0, 0, 0, 0.2);padding:10px">
            <el-col :span="24">
              <img src="../../assets/crimal_1_03.jpg" style="width:100px">
            </el-col>
              <el-col :span="24">
                张三犯
              </el-col>
          </div>
        </el-col>
        <el-col :span="2" style="padding:15px 5px;">
          <div style="height:160px;background: rgba(0, 0, 0, 0.2);padding:10px">
            <el-col :span="24">
              <img src="../../assets/crimal_1_03.jpg" style="width:100px">
            </el-col>
              <el-col :span="24">
                张三犯
              </el-col>
          </div>
        </el-col>
        <el-col :span="2" style="padding:15px 5px;">
          <div style="height:160px;background: rgba(0, 0, 0, 0.2);padding:10px">
            <el-col :span="24">
              <img src="../../assets/crimal_1_03.jpg" style="width:100px">
            </el-col>
              <el-col :span="24">
                张三犯
              </el-col>
          </div>
        </el-col>
        <el-col :span="2" style="padding:15px 5px;">
          <div style="height:160px;background: rgba(0, 0, 0, 0.2);padding:10px">
            <el-col :span="24">
              <img src="../../assets/crimal_1_03.jpg" style="width:100px">
            </el-col>
              <el-col :span="24">
                张三犯
              </el-col>
          </div>
        </el-col>
        <el-col :span="2" style="padding:15px 5px;">
          <div style="height:160px;background: rgba(0, 0, 0, 0.2);padding:10px">
            <el-col :span="24">
              <img src="../../assets/crimal_1_03.jpg" style="width:100px">
            </el-col>
              <el-col :span="24">
                张三犯
              </el-col>
          </div>
        </el-col>
        <el-col :span="2" style="padding:15px 5px;">
          <div style="height:160px;background: rgba(0, 0, 0, 0.2);padding:10px">
            <el-col :span="24">
              <img src="../../assets/crimal_1_03.jpg" style="width:100px">
            </el-col>
              <el-col :span="24">
                张三犯
              </el-col>
          </div>
        </el-col>
        <el-col :span="2" style="padding:15px 5px;">
          <div style="height:160px;background: rgba(0, 0, 0, 0.2);padding:10px">
            <el-col :span="24">
              <img src="../../assets/crimal_1_03.jpg" style="width:100px">
            </el-col>
              <el-col :span="24">
                张三犯
              </el-col>
          </div>
        </el-col>
        <el-col :span="2" style="padding:15px 5px;">
          <div style="height:160px;background: rgba(0, 0, 0, 0.2);padding:10px">
            <el-col :span="24">
              <img src="../../assets/crimal_1_03.jpg" style="width:100px">
            </el-col>
              <el-col :span="24">
                张三犯
              </el-col>
          </div>
        </el-col>
        <el-col :span="2" style="padding:15px 5px;">
          <div style="height:160px;background: rgba(0, 0, 0, 0.2);padding:10px">
            <el-col :span="24">
              <img src="../../assets/crimal_1_03.jpg" style="width:100px">
            </el-col>
              <el-col :span="24">
                张三犯
              </el-col>
          </div>
        </el-col>
        <el-col :span="2" style="padding:15px 5px;">
          <div style="height:160px;background: rgba(0, 0, 0, 0.2);padding:10px">
            <el-col :span="24">
              <img src="../../assets/crimal_1_03.jpg" style="width:100px">
            </el-col>
              <el-col :span="24">
                张三犯
              </el-col>
          </div>
        </el-col>
        <el-col :span="2" style="padding:15px 5px;">
          <div style="height:160px;background: rgba(0, 0, 0, 0.2);padding:10px">
            <el-col :span="24">
              <img src="../../assets/crimal_1_03.jpg" style="width:100px">
            </el-col>
              <el-col :span="24">
                张三犯
              </el-col>
          </div>
        </el-col>
        <el-col :span="2" style="padding:15px 5px;">
          <div style="height:160px;background: rgba(0, 0, 0, 0.2);padding:10px">
            <el-col :span="24">
              <img src="../../assets/crimal_1_03.jpg" style="width:100px">
            </el-col>
              <el-col :span="24">
                张三犯
              </el-col>
          </div>
        </el-col>
        <el-col :span="2" style="padding:15px 5px;">
          <div style="height:160px;background: rgba(0, 0, 0, 0.2);padding:10px">
            <el-col :span="24">
              <img src="../../assets/crimal_1_03.jpg" style="width:100px">
            </el-col>
              <el-col :span="24">
                张三犯
              </el-col>
          </div>
        </el-col>
        <el-col :span="2" style="padding:15px 5px;">
          <div style="height:160px;background: rgba(0, 0, 0, 0.2);padding:10px">
            <el-col :span="24">
              <img src="../../assets/crimal_1_03.jpg" style="width:100px">
            </el-col>
              <el-col :span="24">
                张三犯
              </el-col>
          </div>
        </el-col>
        <el-col :span="2" style="padding:15px 5px;">
          <div style="height:160px;background: rgba(0, 0, 0, 0.2);padding:10px">
            <el-col :span="24">
              <img src="../../assets/crimal_1_03.jpg" style="width:100px">
            </el-col>
              <el-col :span="24">
                张三犯
              </el-col>
          </div>
        </el-col>
        <el-col :span="2" style="padding:15px 5px;">
          <div style="height:160px;background: rgba(0, 0, 0, 0.2);padding:10px">
            <el-col :span="24">
              <img src="../../assets/crimal_1_03.jpg" style="width:100px">
            </el-col>
              <el-col :span="24">
                张三犯
              </el-col>
          </div>
        </el-col>
        <el-col :span="2" style="padding:15px 5px;">
          <div style="height:160px;background: rgba(0, 0, 0, 0.2);padding:10px">
            <el-col :span="24">
              <img src="../../assets/crimal_1_03.jpg" style="width:100px">
            </el-col>
              <el-col :span="24">
                张三犯
              </el-col>
          </div>
        </el-col>
        <el-col :span="2" style="padding:15px 5px;">
          <div style="height:160px;background: rgba(0, 0, 0, 0.2);padding:10px">
            <el-col :span="24">
              <img src="../../assets/crimal_1_03.jpg" style="width:100px">
            </el-col>
              <el-col :span="24">
                张三犯
              </el-col>
          </div>
        </el-col>
        <el-col :span="2" style="padding:15px 5px;">
          <div style="height:160px;background: rgba(0, 0, 0, 0.2);padding:10px">
            <el-col :span="24">
              <img src="../../assets/crimal_1_03.jpg" style="width:100px">
            </el-col>
              <el-col :span="24">
                张三犯
              </el-col>
          </div>
        </el-col>

      </el-col>
      <el-col :span="1" style="background-color:red">

      </el-col>
    </el-row>

  </el-row>
</template>

<script>
import { BasicUrl, IMG, ajaxUrl } from "../../config";
import { mapState } from "vuex";

export default {
  name: "batchOut",
  data() {
    return {
      orgTime: "0",
      seachNum: "0",
      searchModeShow: false,
      TimeShow: false,
      isShow1: true,
      isShow2: false,
      isB1: true,
      isB2: false,
      areaNameList: [], //外出地点
      areaPages: 0, //外出地点总页数
      areaNowPage: 1, //外出地点当前页
      areaListAll: 0, //外出地点总数
      areaA: 1,
      areaB: 12,
      reasonList: [], // 外出事由
      reasonNowPage: 1, // 外出事由当前页码
      reasonPages: 1, // 外出事由总页码
      reasonListAll: 0,
      reasonA: 1,
      reasonB: 30,
      isSuccess: 0,

      outCriminals: [], //外出罪犯信息
      outPolices: [], //外出陪同民警信息
      outPages: 1, //外出罪犯总页数
      outNowPage: 1, //外出罪犯当前页
      outListAll: 0, //外出罪犯总数
      outCriminalsA: 1,
      outCriminalsB: 12,
      outPolicePages: 1, //外出民警总页数
      outPoliceNowPage: 1, //外出民警当前页
      outPoliceListAll: 0, //外出民警总数
      outPoliceA: 1,
      outPoliceB: 6,
      alertText: "",
      starPerInterval: "",
      checkPlice: ""
    };
  },
  computed: {
    ...mapState({
      criminalList: state => state.criminalList,
      receiveDataMsgType22: state => state.outregister.receiveDataMsgType22,
      receiveDataMsgType27: state => state.outregister.receiveDataMsgType27,
      police_hash: state => state.outregister.police_hash
    })
  },
  methods: {
    /*搜索输入按键*/
    enterNum: function(Num) {
      if (Num == "-") {
        this.seachNum = "";
      } else {
        this.seachNum = this.seachNum + Num;
      }
    },
    setTime: function() {
      if (this.seachNum == "") {
        this.seachNum = this.orgTime;
      }
      this.searchModeShow = false;
    },
    toggle1: function() {
      this.isShow1 = true;
      this.isShow2 = false;
      this.isB1 = true;
      this.isB2 = false;
      this.recordPage = 0;
    },
    toggle2: function() {
      this.isShow1 = false;
      this.isShow2 = true;
      this.isB1 = false;
      this.isB2 = true;
    },
    chooseArea: function(dom) {
      for (var i = 0; i < this.areaNameList.length; i++) {
        this.areaNameList[i].ischoose = false;
      }
      this.areaNameList[dom + this.areaA - 1].ischoose = !this.areaNameList[
        dom + this.areaA - 1
      ].ischoose;
    },
    chooseReason: function(dom, isNeed, time) {
      for (var i = 0; i < this.reasonList.length; i++) {
        this.reasonList[i].ischoose = false;
      }
      this.reasonList[dom + this.reasonA - 1].ischoose = !this.reasonList[
        dom + this.reasonA - 1
      ].ischoose;
      if (isNeed == "1") {
        this.isNeed = true;
        this.orgTime = time;
        this.seachNum = time;
        this.searchModeShow = true;
        this.TimeShow = true;
      } else {
        this.searchModeShow = false;
        this.TimeShow = false;
      }
    },
    areaGo: function() {
      if (this.areaNowPage < this.areaPages) {
        this.areaNowPage = this.areaNowPage + 1;
        this.areaA = this.areaA + 12;
        this.areaB = this.areaB + 12;
      } else {
        //          alert("已经最后一页了")
      }
    },
    areaBack: function() {
      if (this.areaNowPage == 1) {
        //          alert("已经是第一页了")
      } else {
        this.areaNowPage = this.areaNowPage - 1;
        this.areaA = this.areaA - 12;
        this.areaB = this.areaB - 12;
      }
    },
    ReasonGo: function() {
      if (this.reasonNowPage < this.reasonPages) {
        this.reasonNowPage = this.reasonNowPage + 1;
        this.reasonA = this.reasonA + 30;
        this.reasonB = this.reasonB + 30;
      } else {
        //            alert("已经最后一页了")
      }
    },
    ReasonBack: function() {
      if (this.reasonNowPage == 1) {
        //          alert("已经是第一页了")
      } else {
        this.reasonNowPage = this.reasonNowPage - 1;
        this.reasonA = this.reasonA - 30;
        this.reasonB = this.reasonB - 30;
      }
    },
    outcriminalGo: function() {
      if (this.outNowPage < this.outPages) {
        this.outNowPage = this.outNowPage + 1;
        this.outCriminalsA = this.outCriminalsA + 12;
        this.outCriminalsB = this.outCriminalsB + 12;
      } else {
        //          alert("已经最后一页了")
      }
    },
    outcriminalBack: function() {
      if (this.outNowPage == 1) {
        //          alert("已经是第一页了")
      } else {
        this.outNowPage = this.outNowPage - 1;
        this.outCriminalsA = this.outCriminalsA - 12;
        this.outCriminalsB = this.outCriminalsB - 12;
      }
    },
    outPoliceGo: function() {
      if (this.outPoliceNowPage < this.outPolicePages) {
        this.outPoliceNowPage = this.outPoliceNowPage + 1;
        this.outPoliceA = this.outPoliceA + 6;
        this.outPoliceB = this.outPoliceB + 6;
      } else {
        //          alert("已经最后一页了")
      }
    },
    outPoliceBack: function() {
      if (this.outPoliceNowPage == 1) {
        //          alert("已经是第一页了")
      } else {
        this.outPoliceNowPage = this.outPoliceNowPage - 1;
        this.outPoliceA = this.outPoliceA - 6;
        this.outPoliceB = this.outPoliceB - 6;
      }
    },
    firstWs: function() {
      //开始流动登记
      var vm = this;
      var send1 = {
        Header: {
          MsgID: "201501260000000035",
          MsgType: 20
        },
        Body: JSON.stringify({
          OrgID: localStorage.getItem("OrgID"),
          DoorID: localStorage.getItem("DoorID"),
          AreaID: localStorage.getItem("AreaID"),
          RegType: 2603
        })
      };
      //发送数据
      vm.$ajax({
        url: ajaxUrl,
        data: JSON.stringify(send1),
        success: function(result) {
          if (result.RET == 1) {
            vm.isSuccess = 1;
          } else {
            vm.isSuccess = 0;
          }
        }
      });
    },
    cancel: function() {
      var vm = this;
      var send3 = {
        Header: {
          MsgID: "201501260000000035",
          MsgType: 26
        },
        Body: JSON.stringify({
          OrgID: localStorage.getItem("OrgID"),
          DoorID: localStorage.getItem("DoorID")
        })
      };
      //发送数据
      vm.$ajax({
        url: ajaxUrl,
        data: JSON.stringify(send3),
        success: function(result) {
          if (result.RET == 1) {
            vm.alertText = "取消成功";
            vm.$emit("canRouterChange");
            localStorage.setItem("moveTypes", "0");

            setTimeout(function() {
              vm.alertText = "";
              vm.$router.push({ path: "/" });
            }, 2000);
          } else {
            vm.alertText = "取消失败";
            vm.$emit("canRouterChange");
            setTimeout(function() {
              vm.alertText = "";
            }, 2000);
          }
        }
      });
    },
    delPerson: function(index) {
      var vm = this;
      this.$confirm("确定要删除该人员?", "提示", {
        confirmButtonText: "删除",
        cancelButtonText: "取消",
        type: "warning"
      })
        .then(() => {
          var sendDelPerson = {
            Header: {
              MsgID: "201501260000000031",
              MsgType: 21
            },
            Body: JSON.stringify({
              OrgID: localStorage.getItem("OrgID"),
              DoorID: localStorage.getItem("DoorID"),
              PeopleID:
                vm.outCriminals[index + vm.outCriminalsA - 1]["CriminalID"]
            })
          };
          vm.$ajax({
            url: ajaxUrl,
            data: JSON.stringify(sendDelPerson),
            success: function(result) {
              if (result.RET == 1) {
                vm.outCriminals.splice(index + vm.outCriminalsA - 1, 1);
              } else {
                vm.$message("删除失败");
                //                vm.alertText="删除失败"
                //                setTimeout(function () {
                //                  vm.alertText=""
                //                },2000)
              }
            }
          });
        })
        .catch(() => {});
      //        var r=confirm("确定要删除该人员？");
      //        if (r==true)
      //        {
      //
      //          alert(vm.outCriminals[index+vm.outCriminalsA-1]["CriminalID"])
      //
      //          var sendDelPerson = {
      //            Header: {
      //              MsgID:"201501260000000031",
      //              MsgType:21
      //            },
      //            Body: JSON.stringify({
      //              OrgID : localStorage.getItem('OrgID'),
      //              DoorID : localStorage.getItem('DoorID'),
      //              PeopleID :vm.outCriminals[index+vm.outCriminalsA-1]["CriminalID"]
      //            })
      //          }
      //          $.ajax({
      //            type: "get",
      //            contentType: "application/json; charset=utf-8",
      //            dataType: "jsonp",
      //            jsonp: "callback",
      //            async: false,
      //            url: ajaxUrl,
      //            data:JSON.stringify(sendDelPerson),
      //            success: function (result) {
      //              if(result.RET==1){
      //                  vm.outCriminals.splice(index+vm.outCriminalsA-1,1)
      //              }else {
      //                vm.alertText="删除失败"
      //                setTimeout(function () {
      //                  vm.alertText=""
      //                },2000)
      //
      //              }
      //            },
      //            complete: function (XHR, TS) {
      //              XHR = null;  //回收资源
      //            }
      //          })
      //
      //        }
    },
    //提交登记
    submitOutRegister: function() {
      var vm = this;
      var Criminals = ""; //罪犯数据
      var Polices = ""; //民警数据
      var Areas = ""; //去往区域
      var Reason = ""; //事由

      for (var i = 0; i < vm.outCriminals.length; i++) {
        if (i == 0) {
          Criminals = vm.outCriminals[i]["CriminalID"];
        } else {
          Criminals = Criminals + "," + vm.outCriminals[i]["CriminalID"];
        }
      }
      for (var i = 0; i < vm.areaNameList.length; i++) {
        if (vm.areaNameList[i]["ischoose"]) {
          Areas = vm.areaNameList[i]["FlnkID"];
        }
      }
      for (var i = 0; i < vm.reasonList.length; i++) {
        if (vm.reasonList[i]["ischoose"]) {
          Reason = vm.reasonList[i]["DictCodeName"];
        }
      }
      if (Areas == "" || Reason == "" || Criminals == "") {
        vm.alertText = "外出事由和外出地点必须选择，外出人员也不能为空";
        setTimeout(function() {
          vm.alertText = "";
        }, 2000);
      } else {
        /* var subSvm.$emit('openLogin',true)     */
        var subSetInterval = setInterval(function() {
          if (localStorage.getItem("placemanID") == 0) {
            /*民警还未刷卡*/
          } else if (localStorage.getItem("placemanID") == 1) {
            /* 点击登录框关闭按钮停止检测民警登录情况*/
            clearInterval(subSetInterval);
          } else {
            clearInterval(subSetInterval);
            //陪同民警
            for (var i = 0; i < vm.outPolices.length; i++) {
              if (i == 0) {
                Polices = vm.outPolices[i]["PersonID"];
              } else {
                Polices = Polices + "," + vm.outPolices[i]["PersonID"];
              }
            }
            var sendOutRegister = {
              Header: {
                MsgID: "201501260000000031",
                MsgType: 23
              },
              Body: JSON.stringify({
                OrgID: localStorage.getItem("OrgID"),
                DoorID: localStorage.getItem("DoorID"),
                IsSpectialMove: vm.TimeShow,
                UnhandledTime: parseInt(vm.seachNum),
                Criminals: Criminals,
                Polices: Polices,
                Reason: Reason,
                Areas: Areas
              })
            };
            //发送数据
            vm.$ajax({
              url: ajaxUrl,
              data: JSON.stringify(sendOutRegister),
              success: function(result) {
                localStorage.setItem("moveTypes", "0");
                if (result.RET == 1) {
                  vm.$emit("canRouterChange");
                  vm.alertText = "提交成功";
                  setTimeout(function() {
                    vm.alertText = "";
                    vm.$router.push({ path: "/" });
                  }, 2000);
                } else {
                  vm.$emit("canRouterChange");
                  vm.alertText = "提交失败";
                  setTimeout(function() {
                    vm.alertText = "";
                  }, 2000);
                }
              }
            });
          }
        }, 1000);
      }
    }
  },
  mounted() {
    var vm = this;
    localStorage.setItem("placemanID", "0");
    localStorage.setItem("canRouter", "0");
    /*民警进入该页面是否需要刷卡*/
    var needPassCard = localStorage.getItem("needPassCard");
    var id = "";
    if (needPassCard == 0) {
      localStorage.setItem("moveTypes", "2"); //1为进出工，2为临时外出登记，3为卡绑定
      vm.firstWs();
      vm.checkPlice = setInterval(function() {
        if (
          localStorage.getItem("placemanID") != 0 &&
          localStorage.getItem("placemanID") != 1
        ) {
          var Polices = {};
          Polices["PersonID"] = localStorage.getItem("placemanID");
          Polices["ischoose"] = false;
          Polices["PoliceName"] =
            policeList[0][localStorage.getItem("placemanID")]["PoliceName"];
          Polices["Photo"] = policeList[0][Polices["PersonID"]]["Photo"];
          if (id != localStorage.getItem("placemanID")) {
            vm.outPolices.push(Polices);
            id = localStorage.getItem("placemanID");
          }
          //clearInterval(vm.checkPlice)
        }
      }, 1000);
    } else if (needPassCard == 1) {
      vm.checkPlice = setInterval(function() {
        if (
          localStorage.getItem("placemanID") != 0 &&
          localStorage.getItem("placemanID") != 1
        ) {
          var Polices = {};
          Polices["PersonID"] = localStorage.getItem("placemanID");
          Polices["ischoose"] = false;
          Polices["PoliceName"] =
            policeList[0][localStorage.getItem("placemanID")]["PoliceName"];
          Polices["Photo"] = policeList[0][Polices["PersonID"]]["Photo"];
          vm.outPolices.push(Polices);
          clearInterval(vm.checkPlice);
        }
      }, 1000);
      var outPlice = setInterval(function() {
        if (localStorage.getItem("placemanID") == 0) {
          /*民警还未刷卡*/
        } else if (localStorage.getItem("placemanID") == 1) {
          /* 点击登录框关闭按钮停止检测民警登录情况*/
          clearInterval(outPlice);
        } else {
          localStorage.setItem("moveTypes", "2"); //1为进出工，2为临时外出登记，3为卡绑定
          vm.firstWs();
          clearInterval(outPlice);
          var Polices = {};
          Polices["PersonID"] = localStorage.getItem("placemanID");
          Polices["ischoose"] = false;
          Polices["PoliceName"] =
            policeList[0][localStorage.getItem("placemanID")]["PoliceName"];
          Polices["Photo"] = policeList[0][Polices["PersonID"]]["Photo"];
          vm.outPolices.push(Polices);
        }
      }, 500);
    }

    //      发送人员流动状态  2603临时外出
    //      setInterval(function () {
    //          if(vm.isSuccess==0){
    //            vm.firstWs()
    //          }
    //      },1000)

    //      获取外出登记的人员明细
    vm.starPerInterval = setInterval(function() {
      if (vm.isSuccess == 1) {
        var send2 = {
          Header: {
            MsgID: "201501260000000035",
            MsgType: 22
          },
          Body: JSON.stringify({
            OrgID: localStorage.getItem("OrgID"),
            DoorID: localStorage.getItem("DoorID")
          })
        };
        var send27 = {
          Header: {
            MsgID: "201501260000000035",
            MsgType: 27
          },
          Body: JSON.stringify({
            OrgID: localStorage.getItem("OrgID"),
            DoorID: localStorage.getItem("DoorID")
          })
        };
        //发送数据
        if (vm.ws.readyState == WebSocket.OPEN) {
          vm.ws.send(JSON.stringify(send2));
        }
        if (vm.ws.readyState == WebSocket.OPEN) {
          vm.ws.send(JSON.stringify(send27));
        }
        /*外出登记罪犯信息*/
        var receiveData = vm.receiveDataMsgType22;
        if (receiveData != "" && receiveData != null) {
          var outCriminal = []; //外出罪犯
          for (var i = 0; i < receiveData.length; i++) {
            var Criminal = receiveData[i];
            Criminal["ischoose"] = false;
            Criminal["CriminalName"] =
              vm.criminalList[0][Criminal["CriminalID"]]["CriminalName"];
            Criminal["Photo"] =
              vm.criminalList[0][Criminal["CriminalID"]]["Photo"];
            outCriminal.push(Criminal);
            vm.outCriminals = outCriminal;
            vm.outPages =
              Math.ceil(vm.outCriminals.length / 12) == 0
                ? 1
                : Math.ceil(vm.outCriminals.length / 12);
          }
        }
        /*陪同民警信息*/
        var receiveDataP = vm.receiveDataMsgType27;
        if (receiveDataP != "" && receiveDataP != null) {
          var outPolice = []; //陪同民警
          for (var i = 0; i < receiveDataP.length; i++) {
            var Polices = receiveDataP[i];
            Polices["ischoose"] = false;
            Polices["PoliceName"] =
              policeList[0][Polices.PoliceID]["PoliceName"];
            Polices["Photo"] = policeList[0][Polices.PoliceID]["Photo"];
            outPolice.push(Polices);
            vm.outPolices = outPolice;
            vm.outPolicePages =
              Math.ceil(vm.outPolices.length / 6) == 0
                ? 1
                : Math.ceil(vm.outPolices.length / 6);
          }
        }
      }
    }, 1000);

    //      获取外出地点
    vm.$ajax({
      data: { OrgID: localStorage.getItem("OrgID") },
      url: BasicUrl + "Move/GetOutAreaList" + "?callback=?",
      success: function(result) {
        if (result != "" && result != null) {
          vm.areaListAll = result.length;
          vm.areaPages =
            Math.ceil(result.length / 30) == 0
              ? 1
              : Math.ceil(result.length / 30);
          for (var i = 0; i < result.length; i++) {
            result[i]["ischoose"] = false;
          }
          vm.areaNameList = result;
        }
      }
    });
    //      获取外出事由
    vm.$ajax({
      data: { OrgID: localStorage.getItem("OrgID") },
      url: BasicUrl + "Move/GetMoveReasonList" + "?callback=?",
      success: function(result) {
        if (result != "" && result != null) {
          for (var j = 0; j < result.length; j++) {
            if (result[j].DictCode == 3006) {
              //去除收工出工登记
              result.splice(j, 1);
            }
            if (result[j].DictCode == 3007) {
              result.splice(j, 1);
            }
          }
          vm.reasonListAll = result.length;
          vm.reasonPages =
            Math.ceil(result.length / 12) == 0
              ? 1
              : Math.ceil(result.length / 12);
          for (var i = 0; i < result.length; i++) {
            result[i]["ischoose"] = false;
          }
          vm.reasonList = result;
        }
      }
    });
    /* Coding By Qianjf */
  },
  destroyed: function() {
    clearInterval(this.starPerInterval);
    clearInterval(this.checkPlice);
  }
};
</script>

<style lang="scss">
@import "../../css/batchOut.scss";
</style>
